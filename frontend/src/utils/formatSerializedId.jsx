import parsePhoneNumber from 'libphonenumber-js';

const ddiToFlag = {
  '+93': 'ðŸ‡¦ðŸ‡«', '+355': 'ðŸ‡¦ðŸ‡±', '+213': 'ðŸ‡©ðŸ‡¿', '+376': 'ðŸ‡¦ðŸ‡©', '+244': 'ðŸ‡¦ðŸ‡´',
  '+54': 'ðŸ‡¦ðŸ‡·', '+681': 'ðŸ‡µðŸ‡²', '+43': 'ðŸ‡¦ðŸ‡¹', '+61': 'ðŸ‡¦ðŸ‡º', '+994': 'ðŸ‡¦ðŸ‡¿',
  '+387': 'ðŸ‡§ðŸ‡¦', '+55': 'ðŸ‡§ðŸ‡·', '+246': 'ðŸ‡§ðŸ‡²', '+359': 'ðŸ‡§ðŸ‡¬', '+226': 'ðŸ‡§ðŸ‡«',
  '+257': 'ðŸ‡§ðŸ‡®', '+855': 'ðŸ‡²ðŸ‡²', '+237': 'ðŸ‡¨ðŸ‡²', '+1': 'ðŸ‡¨ðŸ‡¦', '+238': 'ðŸ‡¨ðŸ‡»',
  '+1': 'ðŸ‡¨ðŸ‡½', '+56': 'ðŸ‡¨ðŸ‡±', '+57': 'ðŸ‡¨ðŸ‡´', '+269': 'ðŸ‡°ðŸ‡²', '+242': 'ðŸ‡¨ðŸ‡¬',
  '+243': 'ðŸ‡¨ðŸ‡©', '+682': 'ðŸ‡¨ðŸ‡°', '+506': 'ðŸ‡¨ðŸ‡·', '+225': 'ðŸ‡¨ðŸ‡®', '+385': 'ðŸ‡­ðŸ‡·',
  '+53': 'ðŸ‡¨ðŸ‡º', '+599': 'ðŸ‡§ðŸ‡¶', '+357': 'ðŸ‡¨ðŸ‡¾', '+420': 'ðŸ‡¨ðŸ‡¿', '+45': 'ðŸ‡©ðŸ‡°',
  '+253': 'ðŸ‡©ðŸ‡¯', '+502': 'ðŸ‡¬ðŸ‡¹', '+258': 'ðŸ‡²ðŸ‡¿', '+260': 'ðŸ‡¿ðŸ‡²',
  '+263': 'ðŸ‡¿ðŸ‡¼', '+292': 'ðŸ‡ªðŸ‡¨', '+20': 'ðŸ‡ªðŸ‡¬', '+503': 'ðŸ‡¸ðŸ‡»', '+240': 'ðŸ‡¬ðŸ‡¶',
  '+291': 'ðŸ‡ªðŸ‡·', '+372': 'ðŸ‡ªðŸ‡ª', '+251': 'ðŸ‡ªðŸ‡¹', '+500': 'ðŸ‡¬ðŸ‡¸', '+298': 'ðŸ‡«ðŸ‡´',
  '+679': 'ðŸ‡«ðŸ‡¯', '+358': 'ðŸ‡«ðŸ‡®', '+33': 'ðŸ‡«ðŸ‡·', '+689': 'ðŸ‡µðŸ‡«', '+241': 'ðŸ‡¬ðŸ‡¦',
  '+220': 'ðŸ‡¬ðŸ‡²', '+995': 'ðŸ‡¬ðŸ‡ª', '+233': 'ðŸ‡¬ðŸ‡­', '+350': 'ðŸ‡²ðŸ‡¨', '+30': 'ðŸ‡¬ðŸ‡·',
  '+299': 'ðŸ‡¬ðŸ‡¸', '+502': 'ðŸ‡²ðŸ‡½', '+227': 'ðŸ‡³ðŸ‡ª', '+234': 'ðŸ‡³ðŸ‡¬', '+683': 'ðŸ‡²ðŸ‡­',
  '+64': 'ðŸ‡³ðŸ‡º', '+968': 'ðŸ‡´ðŸ‡²', '+92': 'ðŸ‡µðŸ‡°', '+680': 'ðŸ‡µðŸ‡¼', '+507': 'ðŸ‡µðŸ‡¦',
  '+675': 'ðŸ‡µðŸ‡¬', '+595': 'ðŸ‡µðŸ‡¾', '+51': 'ðŸ‡µðŸ‡ª', '+63': 'ðŸ‡µðŸ‡­', '+48': 'ðŸ‡µðŸ‡±',
  '+351': 'ðŸ‡µðŸ‡¹', '+1787': 'ðŸ‡µðŸ‡·', '+974': 'ðŸ‡¶ðŸ‡¦', '+40': 'ðŸ‡·ðŸ‡´', '+7': 'ðŸ‡·ðŸ‡º',
  '+250': 'ðŸ‡·ðŸ‡¼', '+685': 'ðŸ‡¼ðŸ‡¸', '+378': 'ðŸ‡¸ðŸ‡²', '+239': 'ðŸ‡¦ðŸ‡¨', '+966': 'ðŸ‡¸ðŸ‡¦',
  '+221': 'ðŸ‡¸ðŸ‡³', '+248': 'ðŸ‡¸ðŸ‡­', '+232': 'ðŸ‡±ðŸ‡¸', '+421': 'ðŸ‡¸ðŸ‡°', '+386': 'ðŸ‡¸ðŸ‡®',
  '+27': 'ðŸ‡¿ðŸ‡¦', '+34': 'ðŸ‡ªðŸ‡¸', '+94': 'ðŸ‡±ðŸ‡°', '+249': 'ðŸ‡¸ðŸ‡©', '+597': 'ðŸ‡¸ðŸ‡·',
  '+268': 'ðŸ‡¸ðŸ‡¿', '+46': 'ðŸ‡¸ðŸ‡ª', '+41': 'ðŸ‡¨ðŸ‡­', '+963': 'ðŸ‡¸ðŸ‡¾', '+886': 'ðŸ‡¹ðŸ‡¼',
  '+992': 'ðŸ‡¹ðŸ‡¯', '+255': 'ðŸ‡¹ðŸ‡¿', '+66': 'ðŸ‡¹ðŸ‡­', '+670': 'ðŸ‡¹ðŸ‡±', '+228': 'ðŸ‡¹ðŸ‡¬',
  '+690': 'ðŸ‡¹ðŸ‡´', '+1868': 'ðŸ‡¹ðŸ‡¹', '+216': 'ðŸ‡¹ðŸ‡³', '+90': 'ðŸ‡¹ðŸ‡·', '+993': 'ðŸ‡¹ðŸ‡²',
  '+256': 'ðŸ‡ºðŸ‡¬', '+380': 'ðŸ‡ºðŸ‡¦', '+971': 'ðŸ‡¦ðŸ‡ª', '+44': 'ðŸ‡¬ðŸ‡§', '+1': 'ðŸ‡ºðŸ‡²',
  '+598': 'ðŸ‡ºðŸ‡¾', '+998': 'ðŸ‡ºðŸ‡¿', '+678': 'ðŸ‡»ðŸ‡º', '+58': 'ðŸ‡»ðŸ‡ª', '+84': 'ðŸ‡»ðŸ‡³',
  '+967': 'ðŸ‡¾ðŸ‡ª', '+260': 'ðŸ‡¿ðŸ‡²'
};


const formatSerializedId = (serializedId) => {
  let number = serializedId?.replace('@c.us', '');

  if (!number.startsWith('+')) {
    number = `+${number}`;
  }

  if (!number) {
      return '';
  }
  
  const parsedNumber = parsePhoneNumber(number);
  if (!parsedNumber) {
      return '';
  }

  const formatedNumber = parsedNumber.formatInternational();
  
  let ddi = formatedNumber.match(/^\+(\d+)/)?.[1];
  ddi = ddi?.startsWith('0') ? ddi.substring(1) : ddi;

  const flag = ddiToFlag[`+${ddi}`] || '';

  return formatedNumber.replace(new RegExp(`\\+${ddi}`, 'g'), flag);
};

export default formatSerializedId;